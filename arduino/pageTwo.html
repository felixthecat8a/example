<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta charset="UTF-8"><meta name="author" content="felixthecat8a">
    <meta name="keywords" content="Arduino, RGB, LED, Johnny-Five">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="../favicon.ico" type="image/x-icon">
    <title>Node.js/Arduino &#x1F408;</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="code_styles.css">
    <style>
        h2 {color:mediumseagreen}
        main {
            width: 800px;
            margin: auto;
            padding-left: 20px;
            line-height: 1.5;
        }
        @media all and (max-width: 800px) {
            body {
                font-size: 0.8rem;
                width: 800px;
                margin: auto;
            }
        }
    </style>
</head>
<body>
    <header>
    <h1>Part 2: Control an RGB LED<br>Using Arduino and JavaScript</h1>
    <nav>
        <ul>
            <li><a href="../index.html">Home</a></li>
            <li><a href="./pageOne.html">RGB/Arduino</a></li>
            <li><a href="./pageTwo.html">RGB/Node.js</a></li>
            <li><a href="./pageThree.html">RGB/Socket.io</a></li>
        </ul>
    </nav><br>
    </header>
    <main>
        <article>
            <section>
                <h2>Installing the Software for the Project</h2>
                <p>
                    &nbsp;For this project, we will be using Visual Studio Code with Node.js installed.
                    VS Code displays a code editor and a file explorer usually on the left.
                    You can use the buttons on top of the file explorer to create new files and folders.
                </p><br>
                <p>
                    &nbsp;<strong>Node.js</strong> is an open-source, server-side JavaScript runtime environment built on the Chrome V8 JavaScript engine.
                    <strong>NPM</strong> comes bundled with Node.js installation.
                    NPM is a package manager used for managing and distributing open-source JavaScript packages and libraries.
                </p><br>
                <p>
                    &nbsp;An alternative to NPM is Yarn. <strong>Yarn</strong> is a package manager developed
                    by Facebook in collaboration with other companies and the open-source community to address
                    some limitations of existing package managers.<br>
                </p>
                <ul>
                    <li><b>Visual Studio Code</b> can be downloaded at <a href="http://code.visualstudio.com/" target="_blank" rel="noopener noreferrer">http://code.visualstudio.com/</a>.</li>
                    <li><b>Node.js</b> can be downloaded at <a href="http://nodejs.org/" target="_blank" rel="noopener noreferrer">http://nodejs.org/</a>.</li>
                    <li><b>Yarn</b> can be downloaded using a terminal command.</li>
                        <ul>
                            <li>Open a terminal window with <b>Terminal > New Terminal</b> or <b>View > Terminal</b>.</li>
                            <li><code class="powershell"><span id="yl">npm</span> install <span id="gr">--global</span> yarn</code></li>
                            <li>Verify the installation with <code class="powershell"><span>yarn</span> <span id="gr">--version</span></code></li>
                        </ul>
                </ul>
            </section>
            <section>
                <h2>Creating a Project Directory</h2>
                <p>
                    Create a new project folder or directory. Then, create a new JavaScript file inside the directory.
                    Name the file "rgbLED.js".
                </p>
                <ul>
                    <li>You can also create a project folder and file using PowerShell commands.</li>
                    <ul>
                        <li><code class="powershell"><span id="yl">New-Item</span> <span id="gr">-Path</span> .\Project <span id="gr">-ItemType</span> Directory</code></li>
                        <li><code class="powershell"><span id="yl">New-Item</span> <span id="gr">-Path</span> .\Project\rgbLED.js <span id="gr">-ItemType</span> File</code></li>
                    </ul>
                </ul>
                <p>Enter the project directory & initiate a project using the command terminal.</p>
                <ul>
                    <li><code class="powershell"><span id="yl">cd</span> Project</code></li>
                    <ul>
                        <li>Hint: Use <code class="powershell"><span id="yl">cd..</span></code> to return to a parent directory.</li>
                        <li>Hint: Use quotations, <code class="powershell"><span id="yl">cd</span> <span  id="lsg">'My Project'</span></code> to enter a directory with spaces in the name.</li>
                        <li>Hint: Use <code class="powershell"><span id="yl">cd</span> E:\</code> to enter a directory in a USB drive on drive E.</li>
                    </ul>
                    <li><code class="powershell"><span id="yl">yarn</span> init <span  id="gr">-y</span></code></li>
                    <ul>
                        <li>Adding <code>--yes</code> or <code>-y</code> to the command bypasses the prompt questions.</li>
                        <li>If using NPM, the command is <code class="powershell"><span id="yl">npm</span> init <span  id="gr">--yes</span></code></li>
                    </ul>
                    <li>A <b>package.json</b> file will be generated in the Project directory.</li>
                </ul>
                <p>Install the necessary packages. </p>
                <ul>
                    <li>Install the <b><a href="http://johnny-five.io/" target="_blank" rel="noopener noreferrer">Johnny-Five</a></b> package.</li>
                    <ul>
                        <li><code class="powershell"><span id="yl">yarn</span> add johnny-five</code><li>
                        <ul>
                            <li>or <code class="powershell"><span id="yl">npm</span> install johnny-five</code></li>
                        </ul>
                    </ul>
                    <li>Install the <b><a href="https://serialport.io/" target="_blank" rel="noopener noreferrer">SerialPort</a></b> package.</li>
                    <ul>
                        <li><code class="powershell"><span id="yl">yarn</span> add serialport</code></li>
                        <ul>
                            <li>or <code class="powershell"><span id="yl">npm</span> install serialport</code></li>
                        </ul>
                    </ul>
                    <li>Installing packages creates a <b>package.json</b> file and a <b>yarn.lock</b>.</li>
                    <ul>
                        <li>or <b>package-lock.json</b> file</li>
                    </ul>
                </ul>
                <p>The file directory should look like the file directory map shown.</p>
                <pre class="codeBox">
                    <code>
Project/
├── node_modules/
├── rgbLED.js
├── package.json
└── yarn.lock or package-lock.json
                    </code>
                </pre>
            </section>
            <section>
                <h2>Editing the JavaScript file</h2>
                <ul>
                    <li>Open the file rgbLED.js and add the JavaScript code as shown.</li>
                </ul>
                <pre>
                    <code class="code_javascript">
<span id="gn">/* rgbLED.js */</span>
<span id="bl">const</span> { <span id="sg">Board</span>, <span id="sg">Led</span> } = require(<span id="rd">'johnny-five'</span>);
<span id="bl">const</span> <span id="lt">board</span> = <span id="bl">new</span> <span id="sg">Board</span>();
<span id="gn">/* Requires pins that support PWM (denoted by ~) */</span>
<span id="bl">const</span> <span id="lt">redPin</span> = 11;
<span id="bl">const</span> <span id="lt">greenPin</span> = 10;
<span id="bl">const</span> <span id="lt">bluePin</span> = 9;
<span id="gn">// define each color</span>
<span id="bl">const</span> <span id="lt">redHex</span> = <span id="rd">'FF0000'</span>;
<span id="bl">const</span> <span id="lt">yellowHex</span> = <span id="rd">'FFFF00'</span>;
<span id="bl">const</span> <span id="lt">greenHex</span> = <span id="rd">'00FF00'</span>;
<span id="bl">const</span> <span id="lt">cyanHex</span> = <span id="rd">'00FFFF'</span>;
<span id="bl">const</span> <span id="lt">blueHex</span> = <span id="rd">'0000FF'</span>;
<span id="bl">const</span> <span id="lt">violetHex</span> = <span id="rd">'FF00FF'</span>;
<span id="lt">board</span>.on(<span id="rd">'ready'</span>, ()<span id="bl"> => </span>{
    <span id="lt">console</span>.log(<span id="rd">'Board is ready!'</span>);

    <span id="bl">const</span> <span id="lt">rgb</span> = <span id="bl">new</span> <span id="sg">Led</span>.<span id="sg">RGB</span>({
        pins: {
            red: <span id="lt">redPin</span>,
            green: <span id="lt">greenPin</span>,
            blue: <span id="lt">bluePin</span>
        },
        isAnode: <span id="bl">false</span> <span id="gn">// true if common anode</span>
    }); 
    
    <span id="bl">const</span> <span id="lt">colorWheel</span> = [
        <span id="lt">redHex</span>,
        <span id="lt">yellowHex</span>,
        <span id="lt">greenHex</span>,
        <span id="lt">cyanHex</span>,
        <span id="lt">blueHex</span>,
        <span id="lt">violetHex</span>
    ];

    <span id="bl">let</span> <span id="lt">index</span> = 0;
    <span id="lt">board</span>.loop(1000, () <span id="bl">=></span> { <span id="gn">// every 1 sec (1000 ms)</span>
        <span id="lt">rgb</span>.color(<span id="lt">colorWheel</span>[<span id="lt">index</span>++]);
        <span id="vt">if</span> (<span id="lt">index</span> === <span id="lt">colorWheel</span>.length) {
            <span id="lt">index</span> = 0;
        }
    });
});

                    </code>
                </pre>
            </section>
            <section>
                <h2>Getting the Circuit Ready</h2>
                <p>Build the circuit as shown in the image using an Uno R3 Arduino Board.</p>
                <p>This circuit uses three 220 &Omega; resistors, a breadboard, and jumper wires.</p>
                <img src="./screenshots/rgbBuild.png" alt="Arduino RGB LED Circuit" width="auto" height="140px">
            </section>
            <section>
                <h2>Uploading the Firmata sketch using Arduino IDE</h2>
                <p>The <strong>Firmata</strong> sketch allows an Arduino board to interpret JavaScript code.</p>
                <ol>
                <li>Open the Arduino IDE</li>
                <li>Connect your Arduino Uno board to the USB port.</li>
                <li>Go to "<b>File</b>", then "<b>Examples</b>", then "<b>Firmata</b>" and select "<b>StandardFirmata</b>".</li>
                <li>Go to "<b>Tools</b>", then "<b>Board</b>", and select "<b>Arduino Uno</b>".</li>
                <li>Go to "<b>Tools</b>", then "<b>Port</b>", and select "<b>COM#:Arduino Uno</b>".</li>
                <li>Go to "<b>Sketch</b>", and select "<b>Upload</b>" or click the arrow button.</li>
                <li>You can close the Arduino IDE after you upload Firmata.</li>
                </ol>
            </section>
            <section>
                <h2>Running the Script using Node.js</h2>
                <ul>
                    <li>Run the script using the command <code class="powershell"><span id="yl">node</span> rgbLED.js</code>.</li>
                    <ul>
                        <li>The LED should start flacking different colors.</li>
                        <li>Use <code>"ctrl"+"c"</code> twice to stop the running the script.</li>
                    </ul>
                    <li>Edit the <code>package.json</code> file script section as shown.</li>
                    <li>Start the rgbLED.js script using <code class="powershell"><span id="yl">yarn</span> flash</code>.</li>
                    <ul>
                        <li>If using NPM, <code class="powershell"><span id="yl">npm</span> run flash</code></li>
                    </ul>
                </ul>
                <pre>
                    <code class="code_json">
{
    <span id="sk">"name"</span>: <span id="rd">"project"</span>,
    <span id="sk">"version"</span>: <span id="rd">"1.0.0"</span>,
    <span id="sk">"main"</span>: <span id="rd">"index.js"</span>,
    <span id="sk">"license"</span>: <span id="rd">"MIT"</span>,
    <span id="sk">"dependencies"</span>: {
        <span id="sk">"johnny-five"</span>: <span id="rd">"^2.1.0"</span>,
        <span id="sk">"serialport"</span>: <span id="rd">"^11.0.0"</span>
    },
    <span id="sk">"scripts"</span>: {
        <span id="sk">"flash"</span>: <span id="rd">"node rgbLED.js"</span>
    }
}
                    </code>
                </pre>
                <br>
            </section>
        </article>
        </article>
    </main>
    <footer style="background-color: #00979d;">
    <h5><a href="http://github.com/felixthecat8a" target="_blank" rel="noopener noreferrer">
        <span>&#x1F408;FelixTheCat8a&#128008;</span>
    </a></h5><br>
    </footer>
</body>
</html>